{"version":3,"file":"item_visibility.min.js","sources":["../src/item_visibility.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage which courses are shown in the catalogue.\n *\n * @module     local_resourcelibrary/item_visibility\n * @copyright  2023 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\n// Set the constants for the visibility.\nconst LOCAL_RESOURCELIBRARY_ITEM_VISIBLE = 0;\nconst LOCAL_RESOURCELIBRARY_ITEM_HIDDEN = 1;\n\nclass ItemVisibility {\n    constructor() {\n        this.changeToButtons();\n        this.addEventListeners();\n    }\n\n    /**\n     * Find all elements that have the data-action hidefromcatalogue or showincatalogue\n     * and change the link to a button.\n     */\n    changeToButtons() {\n        const elements = document.querySelectorAll('a[data-action=\"hidefromcatalogue\"], a[data-action=\"showincatalogue\"]');\n        elements.forEach((element) => {\n            // Get the data attributes, create a new button and replace the link with the button,\n            // then set the data attributes to the button.\n            const dataset = element.dataset;\n            const button = document.createElement('span');\n            // Get the CSS classes from the link and add them to the button.\n            const classes = element.classList;\n            classes.forEach((cssclass) => {\n                button.classList.add(cssclass);\n            });\n            // Apply the element dataset to the button.\n            Object.keys(dataset).forEach((key) => {\n                button.dataset[key] = dataset[key];\n            });\n            button.classList.add('btn-link');\n            button.setAttribute('role', 'button');\n\n            // Set the button text.\n            button.innerHTML = element.innerHTML;\n            // Replace the link with the button.\n            element.parentNode.replaceChild(button, element);\n        });\n    }\n\n    /**\n     * Add event listeners.\n     */\n    addEventListeners() {\n        document.addEventListener('click', (event) => {\n            const hidefromcatalogue = event.target.closest('[data-action=\"hidefromcatalogue\"]');\n            if (hidefromcatalogue) {\n                event.preventDefault();\n                this.hideFromCatalogue(hidefromcatalogue);\n            }\n            const showincatalogue = event.target.closest('[data-action=\"showincatalogue\"]');\n            if (showincatalogue) {\n                event.preventDefault();\n                this.showInCatalogue(showincatalogue);\n            }\n        });\n    }\n\n    /**\n     * Hide item from catalogue.\n     *\n     * @param {HTMLElement} element\n     */\n    hideFromCatalogue(element) {\n        const id = element.dataset.id;\n        const itemid = element.dataset.itemid;\n        const itemtype = element.dataset.itemtype;\n        const params = {\n            id: id,\n            itemid: itemid,\n            itemtype: itemtype,\n            visibility: LOCAL_RESOURCELIBRARY_ITEM_HIDDEN\n        };\n        this.sendRequest(params);\n    }\n\n    /**\n     * Show item in catalogue.\n     *\n     * @param {HTMLElement} element\n     */\n    showInCatalogue(element) {\n        const id = element.dataset.id;\n        const itemid = element.dataset.itemid;\n        const itemtype = element.dataset.itemtype;\n        const params = {\n            id: id,\n            itemid: itemid,\n            itemtype: itemtype,\n            visibility: LOCAL_RESOURCELIBRARY_ITEM_VISIBLE\n        };\n        this.sendRequest(params);\n    }\n\n    /**\n     * Send the AJAX request.\n     * @param {Object} params\n     */\n    sendRequest(params) {\n        const items = {\n          items: [params]\n        };\n        Ajax.call([{\n            methodname: 'local_resourcelibrary_set_items_visibility',\n            args: items,\n            done: (data) => {\n                if (data.returneditems) {\n                    this.updateButtons(data.returneditems);\n                } else {\n                    Notification.exception(data);\n                }\n            }\n        }]);\n    }\n\n    /**\n     * Show / Hide the correct buttons based on the Ajax response.\n     * @param {Array} items\n     */\n    updateButtons(items) {\n        items.forEach((item) => {\n            const itemid = item.itemid;\n            const itemtype = item.itemtype;\n            const visibility = item.visibility;\n            const showInCatalogueButton = document.querySelector(\n                `[data-action=\"showincatalogue\"][data-itemid=\"${itemid}\"][data-itemtype=\"${itemtype}\"]`);\n            const hideFromCatalogueButton = document.querySelector(\n                `[data-action=\"hidefromcatalogue\"][data-itemid=\"${itemid}\"][data-itemtype=\"${itemtype}\"]`);\n\n            if (visibility === LOCAL_RESOURCELIBRARY_ITEM_VISIBLE) {\n                if (showInCatalogueButton) {\n                    showInCatalogueButton.classList.add('d-none');\n                }\n                if (hideFromCatalogueButton) {\n                    hideFromCatalogueButton.classList.remove('d-none');\n                    hideFromCatalogueButton.classList.add('blink');\n                    setTimeout(() => {\n                        hideFromCatalogueButton.classList.remove('blink');\n                    }, 1000);\n                }\n            } else if (visibility === LOCAL_RESOURCELIBRARY_ITEM_HIDDEN) {\n                if (showInCatalogueButton) {\n                    showInCatalogueButton.classList.remove('d-none');\n                    showInCatalogueButton.classList.add('blink');\n                    setTimeout(() => {\n                        showInCatalogueButton.classList.remove('blink');\n                    }, 1000);\n                }\n                if (hideFromCatalogueButton) {\n                    hideFromCatalogueButton.classList.add('d-none');\n                }\n            }\n        });\n    }\n}\n\nconst init = () => {\n    new ItemVisibility();\n};\n\nexport default {\n    init: init\n};"],"names":["ItemVisibility","constructor","changeToButtons","addEventListeners","document","querySelectorAll","forEach","element","dataset","button","createElement","classList","cssclass","add","Object","keys","key","setAttribute","innerHTML","parentNode","replaceChild","addEventListener","event","hidefromcatalogue","target","closest","preventDefault","hideFromCatalogue","showincatalogue","showInCatalogue","params","id","itemid","itemtype","visibility","sendRequest","items","call","methodname","args","done","data","returneditems","updateButtons","exception","item","showInCatalogueButton","querySelector","hideFromCatalogueButton","remove","setTimeout","init"],"mappings":";;;;;;;mLA8BMA,eACFC,mBACSC,uBACAC,oBAOTD,kBACqBE,SAASC,iBAAiB,wEAClCC,SAASC,gBAGRC,QAAUD,QAAQC,QAClBC,OAASL,SAASM,cAAc,QAEtBH,QAAQI,UAChBL,SAASM,WACbH,OAAOE,UAAUE,IAAID,aAGzBE,OAAOC,KAAKP,SAASF,SAASU,MAC1BP,OAAOD,QAAQQ,KAAOR,QAAQQ,QAElCP,OAAOE,UAAUE,IAAI,YACrBJ,OAAOQ,aAAa,OAAQ,UAG5BR,OAAOS,UAAYX,QAAQW,UAE3BX,QAAQY,WAAWC,aAAaX,OAAQF,YAOhDJ,oBACIC,SAASiB,iBAAiB,SAAUC,cAC1BC,kBAAoBD,MAAME,OAAOC,QAAQ,qCAC3CF,oBACAD,MAAMI,sBACDC,kBAAkBJ,0BAErBK,gBAAkBN,MAAME,OAAOC,QAAQ,mCACzCG,kBACAN,MAAMI,sBACDG,gBAAgBD,qBAUjCD,kBAAkBpB,eAIRuB,OAAS,CACXC,GAJOxB,QAAQC,QAAQuB,GAKvBC,OAJWzB,QAAQC,QAAQwB,OAK3BC,SAJa1B,QAAQC,QAAQyB,SAK7BC,WArE8B,QAuE7BC,YAAYL,QAQrBD,gBAAgBtB,eAINuB,OAAS,CACXC,GAJOxB,QAAQC,QAAQuB,GAKvBC,OAJWzB,QAAQC,QAAQwB,OAK3BC,SAJa1B,QAAQC,QAAQyB,SAK7BC,WAxF+B,QA0F9BC,YAAYL,QAOrBK,YAAYL,cACFM,MAAQ,CACZA,MAAO,CAACN,uBAELO,KAAK,CAAC,CACPC,WAAY,6CACZC,KAAMH,MACNI,KAAOC,OACCA,KAAKC,mBACAC,cAAcF,KAAKC,qCAEXE,UAAUH,UAUvCE,cAAcP,OACVA,MAAM9B,SAASuC,aACLb,OAASa,KAAKb,OACdC,SAAWY,KAAKZ,SAChBC,WAAaW,KAAKX,WAClBY,sBAAwB1C,SAAS2C,qEACaf,oCAA2BC,gBACzEe,wBAA0B5C,SAAS2C,uEACaf,oCAA2BC,gBA9HlD,IAgI3BC,YACIY,uBACAA,sBAAsBnC,UAAUE,IAAI,UAEpCmC,0BACAA,wBAAwBrC,UAAUsC,OAAO,UACzCD,wBAAwBrC,UAAUE,IAAI,SACtCqC,YAAW,KACPF,wBAAwBrC,UAAUsC,OAAO,WAC1C,OAxImB,IA0InBf,aACHY,wBACAA,sBAAsBnC,UAAUsC,OAAO,UACvCH,sBAAsBnC,UAAUE,IAAI,SACpCqC,YAAW,KACPJ,sBAAsBnC,UAAUsC,OAAO,WACxC,MAEHD,yBACAA,wBAAwBrC,UAAUE,IAAI,4BAW3C,CACXsC,KALS,SACLnD"}