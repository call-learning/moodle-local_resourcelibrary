define ("local_resourcelibrary/view",["jquery","local_resourcelibrary/repository","core/paged_content_factory","core/pubsub","core/custom_interaction_events","core/notification","core/templates","core_course/events","local_resourcelibrary/selectors","core/paged_content_events"],function(a,b,c,d,e,f,g,h,i,j){var k={ENTITES_CARDS:"local_resourcelibrary/view-cards",ENTITIES_LIST:"local_resourcelibrary/view-list",NOENTITIES:"local_resourcelibrary/no-entities"},l=[12,24,48],m=[],n=0,o=0,p=null,q=[],r="course",s=0,t=function(a){var b=a.find(i.entityView.region);return{display:b.attr("data-display"),sort:{column:b.attr("data-sort-column"),order:b.attr("data-sort-order")},displaycategories:b.attr("data-displaycategories")}},u={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,persistentLimitKey:"local_resourcelibrary_user_paging_preference"},v=function(a,c,d,e){if("course"===r){return b.getFilteredCourseList({categoryid:0,sorting:[{column:a.sort.column,order:a.sort.order}],filters:c,limit:d,offset:e})}else{return b.getFilteredModulesList({courseid:s,sorting:[{column:a.sort.column,order:a.sort.order}],filters:c,limit:d,offset:e})}},w=function(a,b){return a.find("[data-region=\"paged-content-page\"][data-page=\""+b+"\"]")},x=function(a,b){var c=[];if(b.entities!==void 0){c=b.entities}var d=t(a),e="";if("list"===d.display){e=k.ENTITIES_LIST}else{e=k.ENTITES_CARDS}if("on"!==d.displaycategories){c=c.map(function(a){delete a.category;return a})}if(c.length){return g.render(e,{entities:c})}else{var f=a.find(i.entityView.region).attr("data-noentitiesimg");return g.render(k.NOENTITIES,{noentitiesimg:f})}},y=function(a){this.find(i.entityView.region).attr("data-paging",a)},z=function(a,b){var c=b+j.SET_ITEMS_PER_PAGE_LIMIT;d.subscribe(c,y.bind(a))},A=function(a){var b=l,c=parseInt(a.find(i.entityView.region).attr("data-paging"),10);if(c){b=l.map(function(a){var b=!1;if(a===c){b=!0}return{value:a,active:b}})}return b},B=function(b){p="local_resourcelibrary"+b.attr("id")+"_"+Math.random();var d=A(b),e=t(b),h=a.extend({},u);h.eventNamespace=p;var j=c.createWithLimit(d,function(a,c){var d=[];a.forEach(function(a){var g=a.pageNumber,h=a.limit;if(o!==h){m=[];n=0}if(n===g){c.allItemsLoaded(n);d.push(x(b,m[g]));return}o=h;var i={};if("course"!==r){i=s}var j=v(e,q,h,h*(g-1),i).then(function(d){m[g]={entities:d};if(m[g].entities.length<a.limit){n=g;c.allItemsLoaded(g)}return x(b,m[g])}).catch(f.exception);d.push(j)});return d},h);j.then(function(a,c){z(b,p);return g.replaceNodeContents(b.find(i.entityView.region),a,c)}).done(function(){var a=document.querySelector(i.entityView.region+" .paged-content-page-container"),b=new MutationObserver(function waitForNodeReplacement(b){if(b){b.forEach(function(b){if("childList"===b.type){var c,d=new CustomEvent("resource_library_card_rendered",{rootNode:a});if(0<(null===(c=b.removedNodes)||void 0===c?void 0:c.length)){document.dispatchEvent(d)}}})}});b.observe(a,{childList:!0});return!0}).catch(f.exception)},C=function(a){e.define(a,[e.events.activate])},D=function(b){b=a(b);m=[];n=0;B(b);r=b.attr("data-entity-type");s=parseInt(b.attr("data-parent-id"));if(!b.attr("data-init")){C(b);b.attr("data-init",!0)}},E=function(a){if(0<m.length){m.forEach(function(b,c){var d=w(a,c);x(a,b).then(function(a,b){return g.replaceNodeContents(d,a,b)}).catch(f.exception)})}else{D(a)}};return{init:function init(b){a(document).on("resourcelibrary-filters-inited resourcelibrary-filters-change",function(a,c){q=c;this.refresh(b)}.bind(this))},reset:E,refresh:D}});
//# sourceMappingURL=view.min.js.map
