{"version":3,"file":"permalink.min.js","sources":["../src/permalink.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * A javascript module to display the current's filter permanent link\n *\n * @copyright  2020 CALL Learning 2020 - Laurent David laurent@call-learning.fr\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/config', 'core/templates', 'core/toast', 'core/str', 'core/notification'],\n    function($, config, Templates, Toast, Str, Notification) {\n\n    var Permalink = {};\n    Permalink.catalogURL = null;\n    Permalink.setupCopyLink = function(triggerid, targetid) {\n        document.querySelector(\"#\" + triggerid).addEventListener(\"click\",\n            function() {\n                var target = document.getElementById(targetid);\n                target.select();\n                if (document.execCommand(\"copy\")) {\n                    Toast.add(Str.get_string('copied', 'local_resourcelibrary'), null, 'success');\n                }\n            });\n    };\n\n    Permalink.init = function() {\n        Permalink.catalogURL = new URL(window.location.href);\n        $(document).on('resourcelibrary-filters-change', function(e, filterarray) {\n                filterarray.forEach(function(f) {\n                    const fieldname = 'customfield_' + f.shortname;\n                    if (f.value) {\n                        Permalink.catalogURL.searchParams.append(fieldname + '[operator]', f.operator);\n                        Permalink.catalogURL.searchParams.append(fieldname + '[value]', f.value);\n                        Permalink.catalogURL.searchParams.append(fieldname + '[type]', f.type);\n                    }\n                });\n                Templates.render('local_resourcelibrary/permalink',\n                    {url: Permalink.catalogURL.toString()}).then(\n                    function(html, js) {\n                        return Templates.replaceNodeContents('#resourcelibrary-permalink', html, js);\n                    }\n                ).catch(Notification.exception);\n            }\n        );\n    };\n    return Permalink;\n});\n"],"names":["define","$","config","Templates","Toast","Str","Notification","Permalink","triggerid","targetid","document","querySelector","addEventListener","getElementById","select","execCommand","add","get_string","catalogURL","URL","window","location","href","on","e","filterarray","forEach","f","fieldname","shortname","value","searchParams","append","operator","type","render","url","toString","then","html","js","replaceNodeContents","catch","exception"],"mappings":";;;;;;AAqBAA,OAAM,kCAAC,CAAC,SAAU,cAAe,iBAAkB,aAAc,WAAY,sBACzE,SAASC,EAAGC,OAAQC,UAAWC,MAAOC,IAAKC,cAE3C,IAAIC,UAAY,CAChBA,WAAuB,KACvBA,cAA0B,SAASC,UAAWC,UAC1CC,SAASC,cAAc,IAAMH,WAAWI,iBAAiB,SACrD,WACiBF,SAASG,eAAeJ,UAC9BK,SACHJ,SAASK,YAAY,SACrBX,MAAMY,IAAIX,IAAIY,WAAW,SAAU,yBAA0B,KAAM,UAE3E,KAGRV,KAAiB,WACbA,UAAUW,WAAa,IAAIC,IAAIC,OAAOC,SAASC,MAC/CrB,EAAES,UAAUa,GAAG,kCAAkC,SAASC,EAAGC,aACrDA,YAAYC,SAAQ,SAASC,GACzB,MAAMC,UAAY,eAAiBD,EAAEE,UACjCF,EAAEG,QACFvB,UAAUW,WAAWa,aAAaC,OAAOJ,UAAY,aAAcD,EAAEM,UACrE1B,UAAUW,WAAWa,aAAaC,OAAOJ,UAAY,UAAWD,EAAEG,OAClEvB,UAAUW,WAAWa,aAAaC,OAAOJ,UAAY,SAAUD,EAAEO,MAEzE,IACA/B,UAAUgC,OAAO,kCACb,CAACC,IAAK7B,UAAUW,WAAWmB,aAAaC,MACxC,SAASC,KAAMC,IACX,OAAOrC,UAAUsC,oBAAoB,6BAA8BF,KAAMC,GAEjF,IAAEE,MAAMpC,aAAaqC,UACzB,MAGR,OAAOpC,SACX"}