{"version":3,"file":"view_nav.min.js","sources":["../src/view_nav.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses or course modules view for the Resource Library.\n *\n * Inspired from the Course overview block.\n * @copyright  2020 CALL Learning 2020 - Laurent David laurent@call-learning.fr\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n    [\n        'jquery',\n        'core/custom_interaction_events',\n        'local_resourcelibrary/repository',\n        'local_resourcelibrary/view',\n        'local_resourcelibrary/selectors'\n    ],\n    function(\n        $,\n        CustomEvents,\n        Repository,\n        View,\n        Selectors\n    ) {\n\n        var SELECTORS = {\n            MODIFIERS: '[data-region=\"display-modifiers\"]',\n            SORT_OPTION: '[data-sort]',\n            DISPLAY_OPTION: '[data-display-option]'\n        };\n\n        /**\n         * Update the user preference for the block.\n         *\n         * @param {String} filter The type of filter: display/sort.\n         * @param {String} value The current preferred value.\n         */\n        var updatePreferences = function(filter, value) {\n            var type = null;\n            if (filter === 'display') {\n                type = 'local_resourcelibrary_user_view_preference';\n            } else if (filter === 'sort') {\n                type = 'local_resourcelibrary_user_sort_preference';\n            }\n            if (type) {\n                Repository.updateUserPreferences({\n                    preferences: [\n                        {\n                            type: type,\n                            value: value\n                        }\n                    ]\n                });\n            }\n        };\n\n        /**\n         * Event listener for the Display filter (cards, list).\n         *\n         * @param {object} root The root element for the overview block\n         */\n        var registerSelector = function(root) {\n\n            var Selector = root.find(SELECTORS.MODIFIERS);\n\n            CustomEvents.define(Selector, [CustomEvents.events.activate]);\n            Selector.on(\n                CustomEvents.events.activate,\n                SELECTORS.SORT_OPTION,\n                function(e, data) {\n                    var option = $(e.target);\n\n                    if (option.hasClass('active')) {\n                        // If it's already active then we don't need to do anything.\n                        return;\n                    }\n\n                    var sortoption = option.attr('data-sort');\n                    var sortcolumn = option.attr('data-column');\n                    // Update model.\n                    root.find(Selectors.entityView.region).attr('data-sort-column', sortcolumn);\n                    root.find(Selectors.entityView.region).attr('data-sort-order', sortoption);\n                    updatePreferences('sort', sortcolumn + ',' + sortoption);\n\n                    // Reset the views.\n                    View.refresh(root);\n                    data.originalEvent.preventDefault();\n                }\n            );\n            CustomEvents.define(Selector, [CustomEvents.events.activate]);\n            Selector.on(\n                CustomEvents.events.activate,\n                SELECTORS.DISPLAY_OPTION,\n                function(e, data) {\n                    var option = $(e.target);\n\n                    if (option.hasClass('active')) {\n                        return;\n                    }\n\n                    var displayoptions = option.attr('data-display-option');\n\n                    // Update model.\n                    root.find(Selectors.entityView.region).attr('data-display', displayoptions);\n                    updatePreferences('display', displayoptions);\n\n                    // Reset the views.\n                    View.reset(root);\n                    data.originalEvent.preventDefault();\n                }\n            );\n        };\n\n        /**\n         * Initialise the timeline view navigation by adding event listeners to\n         * the navigation elements.\n         *\n         * @param {object} root The root element for the Resource Library\n         */\n        var init = function(root) {\n            root = $(root);\n            registerSelector(root);\n        };\n\n        return {\n            init: init\n        };\n    });\n"],"names":["define","$","CustomEvents","Repository","View","Selectors","SELECTORS","updatePreferences","filter","value","type","updateUserPreferences","preferences","init","root","Selector","find","events","activate","on","e","data","option","target","hasClass","sortoption","attr","sortcolumn","entityView","region","refresh","originalEvent","preventDefault","displayoptions","reset","registerSelector"],"mappings":";;;;;;;AAuBAA,wCACI,CACI,SACA,iCACA,mCACA,6BACA,oCAEJ,SACIC,EACAC,aACAC,WACAC,KACAC,eAGIC,oBACW,oCADXA,sBAEa,cAFbA,yBAGgB,wBAShBC,kBAAoB,SAASC,OAAQC,WACjCC,KAAO,KACI,YAAXF,OACAE,KAAO,6CACW,SAAXF,SACPE,KAAO,8CAEPA,MACAP,WAAWQ,sBAAsB,CAC7BC,YAAa,CACT,CACIF,KAAMA,KACND,MAAOA,iBA2EpB,CACHI,KANO,SAASC,OA1DG,SAASA,UAExBC,SAAWD,KAAKE,KAAKV,qBAEzBJ,aAAaF,OAAOe,SAAU,CAACb,aAAae,OAAOC,WACnDH,SAASI,GACLjB,aAAae,OAAOC,SACpBZ,uBACA,SAASc,EAAGC,UACJC,OAASrB,EAAEmB,EAAEG,YAEbD,OAAOE,SAAS,eAKhBC,WAAaH,OAAOI,KAAK,aACzBC,WAAaL,OAAOI,KAAK,eAE7BZ,KAAKE,KAAKX,UAAUuB,WAAWC,QAAQH,KAAK,mBAAoBC,YAChEb,KAAKE,KAAKX,UAAUuB,WAAWC,QAAQH,KAAK,kBAAmBD,YAC/DlB,kBAAkB,OAAQoB,WAAa,IAAMF,YAG7CrB,KAAK0B,QAAQhB,MACbO,KAAKU,cAAcC,qBAG3B9B,aAAaF,OAAOe,SAAU,CAACb,aAAae,OAAOC,WACnDH,SAASI,GACLjB,aAAae,OAAOC,SACpBZ,0BACA,SAASc,EAAGC,UACJC,OAASrB,EAAEmB,EAAEG,YAEbD,OAAOE,SAAS,eAIhBS,eAAiBX,OAAOI,KAAK,uBAGjCZ,KAAKE,KAAKX,UAAUuB,WAAWC,QAAQH,KAAK,eAAgBO,gBAC5D1B,kBAAkB,UAAW0B,gBAG7B7B,KAAK8B,MAAMpB,MACXO,KAAKU,cAAcC,qBAa3BG,CADArB,KAAOb,EAAEa"}